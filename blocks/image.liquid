{% liquid
  assign block_settings = block.settings
  assign ratio = 1

  case block_settings.image_ratio
    when 'landscape'
      assign ratio = '16 / 9'
    when 'portrait'
      assign ratio = '4 / 5'
    when 'adapt'
      assign ratio = block_settings.image.aspect_ratio
  endcase

  if ratio == 0 or ratio == null
    assign ratio = 1
  endif
%}

{% capture class %}
  image-block image-block--{{ block.id }} image-block--height-{{ block_settings.height }} spacing-style size-style
{% endcapture %}

{% capture style %}
  --ratio: {{ ratio }};
  {% if block_settings.enable_mobile_width_px and block_settings.mobile_width_px > 0 %}
    --image-mobile-width-px: {{ block_settings.mobile_width_px }}px;
  {% endif %}
  {% render 'size-style', settings: block_settings %}
  {% render 'spacing-style', settings: block_settings %}
{% endcapture %}

{% capture image_border_style %}
  --ratio: {{ ratio }};
  {% render 'border-override', settings: block_settings %}
{% endcapture %}

{% liquid
  assign media_width_desktop = '100vw'
  assign media_width_mobile = '100vw'
  assign sizes = 'auto, (min-width: 750px) ' | append: media_width_desktop | append: ', ' | append: media_width_mobile
  assign widths = '240, 352, 832, 1200, 1600, 1920, 2560, 3840'
%}

{% capture image %}
  {%- if block_settings.image -%}
    {%- if block_settings.image_mobile -%}
       {% assign desktop_class  = "image-block__image image-block__image--desktop border-style"%}
    {% else %}
   
         {% assign desktop_class  = "image-block__image border-style"%}
    {% endif %}
    <div class="image-block__media">
      {{
        block_settings.image
        | image_url: width: 3840
        | image_tag:
          width: block_settings.image.width,
          widths: widths,
          height: block_settings.image.height,
          class: desktop_class,
          style: image_border_style,
          sizes: sizes
      }}

      {%- if block_settings.image_mobile -%}
        {{
          block_settings.image_mobile
          | image_url: width: 1200
          | image_tag:
            widths: widths,
            class: 'image-block__image image-block__image--mobile border-style',
            style: image_border_style,
            sizes: sizes
        }}
      {%- endif -%}
    </div>
  {%- else -%}
    <div class="placeholder-image border-style size-style" style="{{ image_border_style }}">
      {{ 'detailed-apparel-1' | placeholder_svg_tag: 'hero__image' }}
    </div>
  {%- endif -%}
{% endcapture %}

{% if block_settings.link == blank %}
  <div class="{{ class }}" style="{{ style }}" {{ block.shopify_attributes }}>
    {{ image }}
  </div>
{% else %}
  <a href="{{ block_settings.link }}" class="{{ class }}" style="{{ style }}" {{ block.shopify_attributes }}>
    {{ image }}
  </a>
{% endif %}



{% stylesheet %}
  .placeholder-image {
    position: relative;
    aspect-ratio: var(--ratio);
    overflow: hidden;
  }

  placeholder-image img {
    width: 100%;
    height: 100%;
    aspect-ratio: var(--ratio);
  }

  .image-block {
    display: flex;
    justify-content: var(--horizontal-alignment, 'inline-start');
  }

  .image-block--height-fill .image-block__image {
    height: 100%;
  }

  .image-block__media {
    position: relative;
    width: 100%;
    flex-shrink: 0;
  }

  .image-block__image {
    object-fit: cover;
    aspect-ratio: var(--ratio);
    width: 100%;
    display: block;
  }

  /* Mobile image override */
  .image-block__image--mobile {
    display: none;
  }

  @media screen and (max-width: 749px) {
    .image-block__image--mobile {
      display: block;
      aspect-ratio: revert-layer;
    }
     .image-block__image--desktop {
      display: none;
    }

    /* ðŸ”¥ Exact px width override */
    .image-block[style*="--image-mobile-width-px"] {
      width: var(--image-mobile-width-px);
      max-width: var(--image-mobile-width-px);
      flex: 0 0 var(--image-mobile-width-px);
    }
  }
{% endstylesheet %}


{% schema %}
{
  "name": "t:names.image",
  "tag": null,
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "t:settings.image"
    },
    {
      "type": "image_picker",
      "id": "image_mobile",
      "label": "Mobile image (optional)"
    },
    {
      "type": "url",
      "id": "link",
      "label": "t:settings.link"
    },
    {
      "type": "header",
      "content": "t:content.size"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        { "value": "adapt", "label": "t:options.auto" },
        { "value": "portrait", "label": "t:options.portrait" },
        { "value": "square", "label": "t:options.square" },
        { "value": "landscape", "label": "t:options.landscape" }
      ],
      "default": "adapt",
      "label": "t:settings.aspect_ratio"
    },

    /* EVERYTHING BELOW IS UNCHANGED */
    {
      "type": "select",
      "id": "width",
      "label": "t:settings.width_desktop",
      "options": [
        { "value": "fit-content", "label": "t:options.fit_content" },
        { "value": "fill", "label": "t:options.fill" },
        { "value": "custom", "label": "t:options.custom" }
      ],
      "default": "fill"
    },
    {
      "type": "range",
      "id": "custom_width",
      "label": "t:settings.custom_width",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "default": 100,
      "visible_if": "{{ block.settings.width == 'custom' }}"
    },
    {
      "type": "select",
      "id": "width_mobile",
      "label": "t:settings.width_mobile",
      "options": [
        { "value": "fit-content", "label": "t:options.fit_content" },
        { "value": "fill", "label": "t:options.fill" },
        { "value": "custom", "label": "t:options.custom" }
      ],
      "default": "fill"
    },
    {
      "type": "range",
      "id": "custom_width_mobile",
      "label": "t:settings.custom_width",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "default": 100,
      "visible_if": "{{ block.settings.width_mobile == 'custom' }}"
    },
    {
      "type": "select",
      "id": "max_width_mobile",
      "label": "t:settings.max_width",
      "options": [
        { "value": "fit-content", "label": "t:options.fit_content" },
        { "value": "fill", "label": "t:options.fill" },
        { "value": "custom", "label": "t:options.custom" }
      ],
      "default": "fill"
    },
    {
      "type": "range",
      "id": "custom_max_width_mobile",
      "label": "t:settings.custom_max_width",
      "min": 0,
      "max": 1000,
      "step": 10,
      "unit": "px",
      "default": 10,
      "visible_if": "{{ block.settings.max_width_mobile == 'custom' }}"
    },
{
  "type": "checkbox",
  "id": "enable_mobile_width_px",
  "label": "Enable exact mobile width (px)",
  "default": false
},
{
  "type": "range",
  "id": "mobile_width_px",
  "label": "Mobile width (px)",
  "min": 40,
  "max": 400,
  "step": 4,
  "unit": "px",
  "default": 116,
  "visible_if": "{{ block.settings.enable_mobile_width_px }}"
},
    {
      "type": "select",
      "id": "height",
      "label": "t:settings.height",
      "options": [
        { "value": "fit", "label": "t:options.fit_content" },
        { "value": "fill", "label": "t:options.fill" }
      ],
      "default": "fit",
      "visible_if": "{{ block.settings.image_ratio == 'adapt' }}"
    }
  ],
  "presets": [
    {
      "name": "t:names.image",
      "category": "t:categories.basic"
    }
  ]
}
{% endschema %}
